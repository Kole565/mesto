(()=>{"use strict";function e(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)}var t={baseUrl:"".concat("https://nomoreparties.co/v1/").concat("apf-cohort-202"),headers:{authorization:"ce0980dc-5940-4090-9195-ad7f9d95467f","Content-Type":"application/json"}};function n(e){return r(fetch("".concat(t.baseUrl).concat(e),{headers:{authorization:"ce0980dc-5940-4090-9195-ad7f9d95467f"}}))}function r(e){return e.then((function(e){return e.ok?e.json().then((function(e){return e})):Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}function o(e){e.classList.add("popup_is-opened"),e.addEventListener("click",(function(t){t.target===e&&c(e)})),document.addEventListener("keydown",a)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}var u=document.querySelector("#card-template").content,i=document.querySelector(".popup_type_edit"),s=document.querySelector(".popup_type_edit-avatar"),p=document.querySelector(".popup_type_new-card"),l=document.querySelector(".popup_type_image");i.classList.add("popup_is-animated"),s.classList.add("popup_is-animated"),p.classList.add("popup_is-animated"),l.classList.add("popup_is-animated");var d,_=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__edit-avatar-button"),y=document.querySelector(".profile__add-button"),v=i.querySelector(".popup__form"),m=v.querySelector(".popup__input_type_name"),S=v.querySelector(".popup__input_type_description"),h=document.querySelector(".profile__title"),q=document.querySelector(".profile__image"),b=document.querySelector(".profile__image"),L=s.querySelector(".popup__form"),E=L.querySelector(".popup__input_type_url"),k=p.querySelector(".popup__form"),C=k.querySelector(".popup__input_type_card-name"),g=k.querySelector(".popup__input_type_url"),x=l.querySelector(".popup__image"),U=l.querySelector(".popup__caption"),T=document.querySelector(".places__list"),A=void 0;function D(e){e.querySelector(".popup__close").addEventListener("click",(function(){c(e)}))}function B(e){return function(e,n,o,c){var a=e.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__title"),i=a.querySelector(".card__image"),s=a.querySelector(".card__like-button"),p=a.querySelector(".card__like-counter"),l=a.querySelector(".card__delete-button");return u.textContent=n.name,i.src=n.link,i.alt=n.name,i.addEventListener("click",c),n.likes.map((function(e){return e._id})).includes(o)&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(){var e;s.classList.contains("card__like-button_is-active")?(e=n._id,r(fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}))).then((function(e){p.textContent=e.likes.length,s.classList.remove("card__like-button_is-active")})):function(e){return r(fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}))}(n._id).then((function(e){p.textContent=e.likes.length,s.classList.add("card__like-button_is-active")}))})),p.textContent=n.likes.length,l.addEventListener("click",(function(e){var o,c=e.target.closest(".card");o=n._id,r(fetch("".concat(t.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:t.headers})),c.remove()})),n.owner._id!==o&&(l.style.display="none"),a}(u,e,A,(function(){var t,n;o(l),D(l),t=e.title,n=e.link,x.src=n,x.alt=t,U.textContent=t}))}_.addEventListener("click",(function(){var e,t;o(i),D(i),e=i.querySelector(".popup__input_type_name"),t=i.querySelector(".popup__input_type_description"),e.value=h.textContent,t.value=q.textContent})),f.addEventListener("click",(function(){o(s),D(s),s.querySelector(".popup__input_type_url").value=b.style.src})),y.addEventListener("click",(function(){var e,t;o(p),D(p),e=p.querySelector(".popup__input_type_card-name"),t=p.querySelector(".popup__input_type_url"),e.value="",t.value=""})),n("/users/me").then((function(e){return h.textContent=e.name,q.textContent=e.about,b.src=e.avatar,e})).then((function(e){A=e._id})).then((function(e){n("/cards").then((function(e){!function(e){e.forEach((function(e){T.append(B(e))}))}(e)}))})),d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(d.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=Array.from(t.querySelectorAll(n.inputSelector)),o=t.querySelector(n.submitButtonSelector);e(r,o,n),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(e,t,t.validationMessage,n)}(t,c,n),e(r,o,n)}))}))}(t,d)})),v.addEventListener("submit",(function(e){var n,o;e.preventDefault(),n=m.value,o=S.value,function(e,n){return r(fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})}))}(n,o).then((function(e){h.textContent=e.name,q.textContent=e.about})),c(i)})),L.addEventListener("submit",(function(e){e.preventDefault();var n,o=E.value,a=L.querySelector(".popup__button");(n=o,r(fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}))).then((function(e){b.src=e.avatar})).finally((function(){a.textContent="Сохранить"})),a.textContent="Сохранение...",c(s)})),k.addEventListener("submit",(function(e){e.preventDefault();var n,o,a=(n=C.value,o=g.value,r(fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:o})}))).then((function(e){B(e)}));T.prepend(a),c(p)}))})();